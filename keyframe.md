# 关键帧提取策略

本项目提供了多种关键帧提取策略，旨在从不同维度（语义、视觉）捕捉视频的核心内容。

## 1. semantic (语义)

此策略侧重于视频的**对话内容**。

**工作流程:**

1.  **目标帧数确定**: 根据视频总时长，设定一个动态的目标帧数（大约每分钟 2.5 帧，总数限制在 8 到 30 帧之间）。
2.  **语义分段**: 尝试将 ASR（语音识别）生成的文本段落（utterances）聚合成持续 20-40 秒的语义片段。
3.  **时间点选择**: 从每个语义片段中选择中间时刻作为候选关键帧时间点。
4.  **数量调整**:
    -   如果候选时间点数量不足，则通过`uniform`（均匀分布）的方式补充，直到满足目标帧数。
    -   如果数量过多，则进行均匀抽样，减少到目标帧数。
5.  **无语音回退**: 如果视频没有有效的语音文本，则完全采用`uniform`策略来提取关键帧。

**优点:**

-   **内容驱动**: 结合了 ASR 结果，能智能地在有信息量的对话发生处提取关键帧。
-   **鲁棒性**: 具备回退机制，即使 ASR 失败或无有效语音，也能保证有关键帧输出。

**缺点:**

-   **依赖 ASR 质量**: 策略强依赖于 ASR 的准确性和时间戳精度。
-   **忽略视觉信息**: 完全没有利用视频本身的视觉信息。一个没有对话但画面发生剧烈变化的场景（如爆炸、转场）的关键帧很可能会被忽略。

---

## 2. visual (视觉)

此策略侧重于视频的**画面变化**。

**工作流程:**

1.  **场景检测**: 利用 `ffmpeg` 的场景检测（Scene Detection）算法，分析视频的每一帧，找出画面发生显著变化的时刻（如镜头切换、场景过渡）。
2.  **候选帧生成**: 将所有检测到的场景切换点作为候选关键帧的时间戳。
3.  **数量调整**:
    -   如果检测到的场景切换点太少，则通过`uniform`策略补充。
    -   如果太多，则进行均匀采样以满足目标帧数。

**优点:**

-   **视觉驱动**: 能精确捕捉到场景切换、镜头变换等视觉上的关键节点。
-   **内容无关**: 不依赖 ASR，对于无对话的视频（如风景片、纯音乐 MV）效果极佳。

**缺点:**

-   **可能过于密集**: 对于剪辑非常频繁的视频，可能会产生大量意义不大的关键帧。
-   **忽略静态信息**: 在一个长镜头中，即使对话内容很重要，只要画面不切换，就不会被选为关键帧。

---

## 3. hybrid (混合)

此策略是 `semantic` 和 `visual` 的结合，旨在实现**内容与视觉的平衡**。

**工作流程:**

1.  **并行分析**: 同时运行 `semantic` 和 `visual` 策略，分别获取两组候选时间点。
2.  **合并与去重**: 将两组时间点合并，并移除在时间上非常接近的帧（例如，2 秒内），以避免冗余。
3.  **数量调整**: 对合并后的最终列表进行补充或采样，以达到目标帧数。

**优点:**

-   **全面性**: 既能捕捉对话中的关键信息，也不会错过视觉上的精彩瞬间。
-   **适用性广**: 对于大多数类型的视频（如访谈、纪录片、Vlog）都能提供高质量的结果。

**缺点:**

-   **计算成本更高**: 需要同时进行 ASR 和场景检测分析。
-   **参数敏感**: 合并和去重逻辑的参数（如“多近算重复”）需要微调以达到最佳效果。

---

## 策略对比总结

| 策略 | 核心思想 | 优点 | 缺点 | 适用场景 |
| :--- | :--- | :--- | :--- | :--- |
| **semantic** | 基于对话内容 | 智能、有信息量 | 依赖 ASR、忽略视觉 | 访谈、演讲、教学视频 |
| **visual** | 基于画面变化 | 精确捕捉转场、不依赖语音 | 可能过于密集、忽略静态内容 | 风景片、快节奏剪辑、体育集锦 |
| **hybrid** | 内容与视觉结合 | 全面、适用性广 | 计算成本高、参数敏感 | 纪录片、Vlog、电影解说 |
| **uniform** | 均匀时间间隔 | 简单、稳定、可预测 | 机械、可能错过所有重点 | 作为其他策略的补充或回退 |